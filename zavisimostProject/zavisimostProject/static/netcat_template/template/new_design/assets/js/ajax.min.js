$(".modal__body form, .contact__formo form").submit(function() {
	var form = $(this);
	$.ajax({
	 type: "POST",
	 url: "/netcat/add.php",
	 dataType: "html",
	 nameFunction: "request",
	 data: $(this).serialize(),
	 cache: false, 
	 success: function(response) {
	   form.find('.result_wrapper').html(response);
	 },
	 error: function(response) {
	   form.find('.result_wrapper').html(response);
	 }
	});
	 return false;
});


$(function() {
	
	
	$('.show_test_results').on('click', function(e) {
		
		e.preventDefault();
			
			var quantityAnswers = $('.formSumTest input:radio:checked').length;
			//console.log(quantityAnswers);
			if (quantityAnswers >= 12) {
				var p = 1;
				var All = document.forms['formSum'];
				var total = 0;
				for (var i = 0; i < All.elements.length; ++i) {
					if (All.elements[i].checked) {
						p = All.elements[i].value;
						total += +p;
					}

				}
				var resultText = '';
				if (total <= 1) {
					resultText = '<p><strong>Ваши баллы: </strong>' + total + '.</p><p>Поздравляем! Признаков алкоголизма у вашего близкого не обнаружено. Такое периодическое употребление принято считать нормой.  На этом этапе отказ от приема спиртного не сопровождается физическим и психологическим дискомфортом. Однако частое употребление сменяется первой стадией алкоголизма всего за несколько месяцев. Поэтому при возможности необходимо ограничивать употребление спиртных напитков, а также пройти этот тест через несколько месяцев.</p>';
				} else if (total > 1 && total <= 3) {
					resultText = '<p><strong>Ваши баллы:</strong> ' + total + '.</p><p><strong>Стадия алкоголизма:</strong> Первая стадия алкоголизма.</p><p>На этом этапе проще всего спасти человека и прервать порочный круг пристрастия. В этот период изменения в организме еще не критичны, и его проще вернуть к здоровому образу жизни.</p>';
				} else if (total >= 4 && total <= 6) {
					resultText = '<p><strong>Ваши баллы: </strong>' + total + '.</p><p><strong>Стадия алкоголизма:</strong> Вторая начальная стадия.</p><p>Количество употреляемого спритного становится опасным для здоровья. В то же время болезнь еще достаточно хорошо поддается лечению. Обращение к специалистам жизненно необходимо для сохранения здоровья.</p>';
				} else if (total >= 7 && total <= 9) {
					resultText = '<p><strong>Ваши баллы: </strong>' + total + '.</p><p><strong>Стадия алкоголизма:</strong> Вторая стадия.</p><p>Сильная алкогольная зависимость. Самостоятельное лечение, уговоры, скандалы не дадут должного эффекта, человеку требуется профессиональная терапевтическая и психологическая помощь. Визит к наркологу и лечение в стационаре - единственный выход вернуться к здоровой жизни.</p>';
				} else if (total >= 10 && total <= 12) {
					resultText = '<p><strong>Ваши баллы: </strong>' + total + '.</p><p><strong>Стадия алкоголизма:</strong> Третья стадия.</p><p>Это поздняя стадия алкозависимости. Постоянный прием спиртосодержащих продуктов продолжается 10-15 лет. Изменения в организме могут повлечь за собой летальный исход. Требуется срочная госпитализация в стационар.</p>';
				}
				
				resultText = resultText + '<button class="btn red" data-fancybox data-src="#feedback">Срочный вызов врача</button>';
				
				document.getElementById('res_txt').innerHTML = resultText;
				$('.result_test_block').removeClass('hide');
				
			} else {
				
				alert('Вы не ответили на все вопросы!');
			}
			
			return false;
	});
	
	
	
	$('.s-articles-tags-inner a').on('click', function(e) {
		$(this).toggleClass('is-active');
		$('.s-articles-tags-block:not(.is-active)').addClass('is-hide');
		$('.s-articles-tags-block[data-tags='+$(this).text()+']').toggleClass('is-active');
		
		if($('.s-articles-tags-inner a.is-active').length == 0) $('.s-articles-tags-block').removeClass('is-hide');
		
	});
	
	
	
	/*
	let str_tele1 = $('.is-hidden_NOTs2').html();
	if( str_tele1 == 'undefined' ) {
	} else {
		let str_tele2 = str_tele1.replace('8 (800) 511-39-56', '<a href="tel:88005113956">8 (800) 511-39-56</a>'); 		
		$('.is-hidden_NOTs2').html(str_tele2);
	}
	*/
	
	
	$('.s-article .slider-for').addClass('owl-carousel');
	$('.s-article .slider-nav').css('display', 'none');
	$('.s-article .slider-for.owl-carousel').owlCarousel({
        loop: true,
        margin: 32,
        nav: false,
        dots: true,
        smartSpeed: 800,
        responsive: {
            0: {
                items: 1,
                margin: 16,
            },
            600: {
                items: 2,
                margin: 16,
            },
            992: {
                items: 3,
                margin: 32
            },
            2000: {
                items: 4,
                margin: 32
            }
        }
    });
	
	
	$('.s-article .slider-video-for').addClass('owl-carousel');
	$('.s-article .slider-video-nav').css('display', 'none');
	$('.s-article .slider-video-for.owl-carousel').owlCarousel({
        loop: true,
        margin: 32,
        nav: false,
        dots: true,
        smartSpeed: 800,
        responsive: {
            0: {
                items: 1,
                margin: 16,
            },
            600: {
                items: 1,
                margin: 16,
            },
            992: {
                items: 2,
                margin: 32
            },
            2000: {
                items: 2,
                margin: 32
            }
        }
    });
	
	
	if( $('.btn-city-mob').length && $('.btn-city-mob').data('modopen') == 333 ) {
		
		let btnt1 = '<button class="btn red btnt1">Все верно</button>';
		let btnt2 = '<button class="btn pink btnt2">Выбрать город</button>';
		let nextext = 'Ваш город <div>' + $('.btn-city-mob').data('modcity') + '?</div>' + btnt1 + btnt2;
		$('#feedback-city .modal__title').html( nextext );
		$('#feedback-city #select_city_modal').addClass( 'hidden-city' );
		
		$('.btn-city-mob .choise__city').trigger('click');
		
	}
	
	$('#feedback-city .btnt1').on('click', function (e) {
		$('#feedback-city .modal__close').trigger('click');
	});
	$('#feedback-city .btnt2').on('click', function (e) {
		$('#feedback-city #select_city_modal').removeClass( 'hidden-city' );
		$('#feedback-city .btnt1').addClass( 'hidden-btnt' );
		$('#feedback-city .btnt2').addClass( 'hidden-btnt' );
	});
	
	
	$('input[name=f_phone]').mask('+7 (000) 000-00-00');
	
	$('.lazy-img').lazy({
		effect: "fadeIn",
		effectTime: 500,
		threshold: 0
	});
	var owl44 = $('.s-gallery__carousel.owl-carousel');
	owl44.owlCarousel();
	owl44.on('changed.owl.carousel', function(event) {
		$('.lazy-img').lazy({
			effect: "fadeIn",
			effectTime: 500,
			threshold: 0
		});
	});


	
	$(window).scroll(function(){
		$(window).scrollTop()>=200?$(".header").addClass("header--scroll"):$(".header").removeClass("header--scroll")
	});
	
	
	$('.s-banner-calc__slide1').slider({
		 range: 'min',
		 min: 16,
		 max: 90,
		 value: 35,
		 slide: function(event, ui){
			$('.s-banner-calc__input1').val(ui.value);
		}
	});
	$('.s-banner-calc__slide2').slider({
		 range: 'min',
		 min: 40,
		 max: 250,
		 value: 110,
		 slide: function(event, ui){
			$('.s-banner-calc__input2').val(ui.value);
		}
	});
	$('.s-banner-calc__slide3').slider({
		 range: 'min',
		 min: 50,
		 max: 3000,
		 value: 250,
		 slide: function(event, ui){
			$('.s-banner-calc__input3').val(ui.value);
		}
	});
	$('.s-banner-calc__slide4').slider({
		 range: 'min',
		 min: 1,
		 max: 99,
		 value: 40,
		 slide: function(event, ui){
			$('.s-banner-calc__input4').val(ui.value);
		}
	});
	$('.s-banner-calc__slide5').slider({
		 range: 'min',
		 min: 1,
		 max: 400,
		 value: 30,
		 slide: function(event, ui){
			$('.s-banner-calc__input5').val(ui.value);
		}
	});
	
	
	$('.s-banner-calc__block-sex .s-banner-calc__radio1').on('click', function (e) {
		$('.s-banner-calc__block-sex .s-banner-calc__radio1').addClass("active");
		$('.s-banner-calc__block-sex .s-banner-calc__radio2').removeClass("active");
	});
	$('.s-banner-calc__block-sex .s-banner-calc__radio2').on('click', function (e) {
		$('.s-banner-calc__block-sex .s-banner-calc__radio2').addClass("active");
		$('.s-banner-calc__block-sex .s-banner-calc__radio1').removeClass("active");
	});
	
	
	$('.s-banner-calc__input1').on('keyup', function (e) {
		$('.s-banner-calc__slide1').slider({'value': $('.s-banner-calc__input1').val()});
	});
	$('.s-banner-calc__input2').on('keyup', function (e) {
		$('.s-banner-calc__slide2').slider({'value': $('.s-banner-calc__input2').val()});
	});
	$('.s-banner-calc__input3').on('keyup', function (e) {
		$('.s-banner-calc__slide3').slider({'value': $('.s-banner-calc__input3').val()});
	});
	$('.s-banner-calc__input4').on('keyup', function (e) {
		$('.s-banner-calc__slide4').slider({'value': $('.s-banner-calc__input4').val()});
	});
	$('.s-banner-calc__input5').on('keyup', function (e) {
		$('.s-banner-calc__slide5').slider({'value': $('.s-banner-calc__input5').val()});
	});
	
	
	$('.calc-page-block .btn-calc-alko').on('click', function (e) {
		
		let alcoholOut;
		let getPromille;
		let weightAlcohol;
		let patientWeight;
		let reductionCoefficient;
		let pureAlcohol;
		let alcoholDrunk;
		let alcoholStrength;
		let patientGender;
		let patientHeight;
		let outIntoxication;
		let outDetox;
		let outPromille;
		
		
		alcoholDrunk = Number(document.querySelector("#drink").value);
		alcoholStrength = Number(document.querySelector("#hard").value);
		patientWeight = Number(document.querySelector("#weight").value);
		patientGender = Number(document.querySelector('.s-banner-calc__gender.active').getAttribute('data-sex'));
		alcoholStrength = Number(alcoholStrength < 10 ? "0.0" + alcoholStrength : "0." + alcoholStrength);
		
		
		patientHeight = 1 === patientGender ? 176 : 168;
		reductionCoefficient = 1 === patientGender ? .7 : .6;
		pureAlcohol = alcoholDrunk * alcoholStrength;
		weightAlcohol = .78 * pureAlcohol;
		
		
		getPromille = weightAlcohol / (patientWeight * reductionCoefficient);
		getPromille = getPromille.toFixed(2);
		
		
		alcoholOut = getPromille/.15;
		alcoholOut = alcoholOut.toFixed(0);
		
		
		outIntoxication = document.querySelector("#intoxication");
		outDetox = document.querySelector("#resHours");
		outPromille = document.querySelector("#resPromille");
		
		outPromille.textContent = getPromille + " промилле (‰)";
		outDetox.textContent = alcoholOut + " ч.";
		getPromille<.3?outIntoxication.textContent="Нормальное состояние":getPromille<1?outIntoxication.textContent="Легкое опьянение":getPromille<2?outIntoxication.textContent="Опьянение средней степени":getPromille<3?outIntoxication.textContent="Сильное опьянение":getPromille<5?outIntoxication.textContent="Острое отравление алкоголем":getPromille>5&&(outIntoxication.textContent="Высокая вероятность летального исхода");
		
		
		$('.calc-page-block .calc-result1').addClass('active');
		$('.calc-page-block .btn-calc-alko').removeClass('red').addClass('pink');
		
		
	});
	
	
	$(window).scroll(function() {
		if($(this).scrollTop() != 0) {
			$('#toTop').fadeIn();
		} else {
			$('#toTop').fadeOut();
		}
	});
	$('#toTop').click(function() {
		$('body,html').animate( {scrollTop:0}, 800 ); 
	});

	
});




/*

$('.menu__btn').click(function (e) {

	document.querySelector('.menu__btn').classList.toggle('is-open-over');
	
});

$(document).click(function (e) {
    var container = $('.menu-service-list');
	var container2 = $('.menu__btn');
    if (container.has(e.target).length === 0) {
		
		if(container2.hasClass('is-open-over')) {
			alert(4);
		} else {
			document.querySelector('.menu-service-list').classList.remove('is-active');
			document.querySelector('.menu__btn').classList.remove('is-active');
		}
    }
});

*/


document.addEventListener( 'click', (e) => {
	const withinBoundaries1 = e.composedPath().includes( document.querySelector( '.menu__btn') );
	const withinBoundaries2 = e.composedPath().includes( document.querySelector( '.menu-service-list') );
	
	if ( ! withinBoundaries1 && ! withinBoundaries2 ) {
		
		document.querySelector('.menu-service-list').classList.remove('is-active');
		document.querySelector('.menu__btn').classList.remove('is-active');
	}
	
});



$('.mobile__menu .menu-list > li:first-child').on('click', function (e) {
	
	let parentOffset = $(this).offset(); 
	let relY = e.pageY - parentOffset.top;
	
	if( relY < 38 ) {
		$('.mobile__menu .menu-list > li:first-child > .down').toggleClass("is-active");
		$('.mobile__menu .menu-list > li:first-child > .submenu').toggleClass("is-active");
	}
	
});



ymaps.ready(init);
function init() {
	if( $('#city_map').length ) {
		var coord = $('#city_map').data('coord');
		var coords = coord.split(',');
		var myMap = new ymaps.Map("city_map", {
				center: [ coords[0], coords[1] ],
				zoom: 16
			}, {
				searchControlProvider: 'yandex#search'
			}),
			 myPlacemark = new ymaps.Placemark(myMap.getCenter(), {
				hintContent: 'Частный медик 24',
				balloonContent: 'Частный медик 24'
			}, {
				// Опции.
				// Необходимо указать данный тип макета.
				iconLayout: 'default#image',
				// Размеры метки.
				iconImageSize: [46, 62],
				iconImageHref: 'https://narcology.clinic/netcat_template/template/1_column/images/pin.png',
				// Смещение левого верхнего угла иконки относительно
				// её"ножки"(точки привязки).
				iconImageOffset: [-31, -46]
			});
			myMap.geoObjects
			.add(myPlacemark);
		myMap.behaviors
			.disable(['scrollZoom']);
	}	
}


$(".city__filter").keyup(function () {
	
  var _this = this;
  var _text = $(this).val();
  if (_text === "") {
	$(this).parent().parent().find('.non_active_city').addClass('hide');
	$(this).parent().parent().find('.inside_city').removeClass('hide');
	$(this).parent().parent().find('.non_active_city').removeClass('million_city');
  } else {
	$(this).parent().parent().find('.non_active_city').addClass('hide');
	$(this).parent().parent().find('.inside_city').addClass('hide');
	$.each($(".non_active_city"), function () {
	  if ($(this).text().toLowerCase().indexOf($(_this).val().toLowerCase()) === -1) { } else { $(this).removeClass('hide'); }
	})
	$.each($(".inside_city"), function () {
	  if ($(this).text().toLowerCase().indexOf($(_this).val().toLowerCase()) === -1) { } else { $(this).removeClass('hide'); }
	});
  }
});


$(".region_no, #select_city, #select_city_cc, #select_city2").click(function () {
  $.ajax({ type: "POST", url: "/ajax/", data: { "city": 'subdomains', "linkdo": window.location.pathname }, cache: false, success: function (data) { $(".region_ul").html(data); } });
});
$(".region_no_g, #select_city_g, #select_city_g1, #select_city_g2").click(function () {
  $.ajax({ type: "POST", url: "/ajax/", data: { "city": 'subfolders', "linkdo": window.location.pathname }, cache: false, success: function (data) { $(".region_ul").html(data); } });
});


$('.jsYes').on('click', function () {
  var ip = $('#ip_city').text();
  $('#select_city').text(ip);
  $('#select_city_cc').text(ip);
  $('#select_city2').text(ip);
  $('#select_city_g').text(ip);
  $(this).parents('.city_ip').fadeOut(300);
});
$('.jsNo').on('click', function () {
  $(this).parents('.city_ip').fadeOut(300);
  $('#select_city_cc').trigger('click');
});


$("[data-iframe]").click(function () {
  var iframe_string = $(this).attr("data-iframe");
  iframe_string = iframe_string.replace("?", "?autoplay=1&mute=1&");
  console.log(iframe_string);
  $(this).html(iframe_string);
  $(this).addClass("active-vio");
});


if ($('.jsStatNumber').length) {
  var first = true;
  var fx = function fx() {
	var dfd = $('.jsStatNumber').map(function (i, el) {
	  var data = parseInt(this.dataset.n, 10);
	  var props = {
		'from': { 'count': 0 },
		'to': { 'count': data }
	  };
	  return $(props.from).animate(props.to, {
		duration: 3000 * 1,
		step: function step(now, fx) {
		  $(el).text(Math.ceil(now));
		},
		complete: function complete() {
		  if (el.dataset.sym !== undefined) {
			el.textContent = el.textContent.concat(el.dataset.sym);
		  }
		}
	  }).promise();
	}).toArray();
	return $.when.apply($, dfd);
  };

  $(window).on('scroll', function () {
	$('.jsStatNumber').each(function () {
	  var Pos = $(this).offset().top;

	  var topOfWindow = $(window).scrollTop();
	  if (Pos < topOfWindow + $(window).height()) {
		if (first) {
		  fx();

		  setTimeout(function () {
			$('.jsStatNumber').each(function () {
			  var num = $(this).text();
			  var result = num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
			  $(this).text(result);
			});
		  }, 3050);

		  first = false;
		}
	  }
	});
  });
	  
};
	


$('.accordion-list td .btn_service').on('click', function () {
  $('.btn-call-c1').trigger('click');
});

	

function goRegions(d){
		
		$('.select-district .district-link').removeClass('active-region');
		$(d).addClass('active-region');
		
	
	  let districtElement = (d.getAttribute("data-district-id"));
	   
	  let arrRegions = [].map.call(document.querySelectorAll('.regions-link[data-id]'), function(el) {
		return el.dataset.id;
	  }); 
	
	
	let regionsElement = document.querySelectorAll('.regions-link')
	for(let i = 0; i < arrRegions.length; i++){
		if (arrRegions[i] === districtElement){
			regionsElement[i].style.display = "block";
		} else {
			regionsElement[i].style.display = "none";
		}
	}
}

function goCity(d){
	
	$('.select-rerions .regions-link').removeClass('active-region');
	$(d).addClass('active-region');
	
	let regionElement = (d.getAttribute("data-region-id"));
	 
	let arrCity = [].map.call(document.querySelectorAll('.city-link[data-id]'), function(el) {
	  return el.dataset.id;
	}); 
	
  let cityElements = document.querySelectorAll('.city-link')
  for(let i = 0; i < arrCity.length; i++){
	  if (arrCity[i] === regionElement){
		  cityElements[i].style.display = "block";
	  } else {
		  cityElements[i].style.display = "none";
	  }
  }
  
}












